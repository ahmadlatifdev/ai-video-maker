<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BossMind Admin Dashboard</title>
  <style>
    :root{
      --bg:#070A12;
      --panel:#0B1020;
      --panel2:#0E1730;
      --stroke:rgba(255,255,255,.08);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.62);
      --muted2:rgba(255,255,255,.44);
      --good:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;
      --p1:#8b5cf6;
      --p2:#22c55e;
      --p3:#f59e0b;
      --chip:rgba(255,255,255,.08);
      --shadow:0 14px 48px rgba(0,0,0,.55);
      --radius:18px;
      --radius2:24px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--font);
      background: radial-gradient(1200px 800px at 25% -10%, rgba(139,92,246,.20), transparent 60%),
                  radial-gradient(900px 700px at 95% 10%, rgba(34,197,94,.16), transparent 55%),
                  radial-gradient(800px 650px at 55% 120%, rgba(245,158,11,.12), transparent 55%),
                  var(--bg);
      color:var(--text);
    }

    .app{
      min-height:100vh;
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:18px;
      padding:18px;
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--stroke);
      border-radius:var(--radius2);
      box-shadow:var(--shadow);
    }

    .sidebar{
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:12px;
      position:sticky;
      top:18px;
      height:calc(100vh - 36px);
      overflow:auto;
    }

    .brand{
      padding:14px 14px 10px;
      border-radius:var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid var(--stroke);
      display:flex;
      gap:12px;
      align-items:center;
    }
    .brand .logo{
      width:34px;height:34px;border-radius:12px;
      background: radial-gradient(circle at 20% 20%, rgba(139,92,246,.95), rgba(34,197,94,.65) 60%, rgba(245,158,11,.45));
      border:1px solid rgba(255,255,255,.12);
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      flex:none;
    }
    .brand h1{ margin:0; font-size:15px; letter-spacing:.3px; font-weight:900; }
    .brand p{ margin:4px 0 0; font-size:12px; color:var(--muted); }

    .nav{
      display:flex;
      flex-direction:column;
      gap:10px;
      padding:10px;
      border-radius:var(--radius);
      background: rgba(255,255,255,.02);
      border:1px solid var(--stroke);
    }

    .navbtn{
      width:100%;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      cursor:pointer;
      color:var(--text);
      transition:.18s transform, .18s background;
    }
    .navbtn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.05); }
    .navbtn.active{
      background: rgba(139,92,246,.12);
      border-color: rgba(139,92,246,.30);
      box-shadow: 0 10px 30px rgba(139,92,246,.10);
    }
    .navleft{ display:flex; flex-direction:column; gap:2px; align-items:flex-start; }
    .navtitle{ font-weight:900; font-size:13px; }
    .navsub{ font-size:12px; color:var(--muted); }

    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:7px 10px;
      border-radius:999px;
      background: var(--chip);
      border:1px solid var(--stroke);
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
    }
    .dot{ width:8px; height:8px; border-radius:50%; display:inline-block; background: var(--warn); }
    .dot.good{ background: var(--good); }
    .dot.bad{ background: var(--bad); }

    .badge{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      font-size:12px;
      background: rgba(255,255,255,.02);
      color: var(--muted);
      white-space:nowrap;
    }
    .badge.p1{ border-color: rgba(139,92,246,.35); color: rgba(216,203,255,.95); background: rgba(139,92,246,.10); }
    .badge.p2{ border-color: rgba(34,197,94,.35); color: rgba(186,255,214,.95); background: rgba(34,197,94,.10); }
    .badge.p3{ border-color: rgba(245,158,11,.35); color: rgba(255,232,186,.95); background: rgba(245,158,11,.10); }

    .main{
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:12px;
      min-width:0;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:14px;
      border-radius:var(--radius);
      background: rgba(255,255,255,.02);
      border:1px solid var(--stroke);
    }
    .topbar h2{ margin:0; font-size:14px; font-weight:900; letter-spacing:.2px; }
    .topbar .right{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .btn{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      color: var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:900;
      font-size:12px;
      transition:.18s transform,.18s background;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.05); }
    .btn.primary{ background: rgba(139,92,246,.14); border-color: rgba(139,92,246,.32); }
    .btn.good{ background: rgba(34,197,94,.14); border-color: rgba(34,197,94,.32); }
    .btn.warn{ background: rgba(245,158,11,.14); border-color: rgba(245,158,11,.32); }
    .btn.danger{ background: rgba(239,68,68,.14); border-color: rgba(239,68,68,.32); }

    .grid{ display:grid; grid-template-columns: 1.2fr .8fr; gap:12px; min-width:0; }
    @media (max-width: 980px){
      .app{ grid-template-columns: 1fr; }
      .sidebar{ position:relative; height:auto; top:auto; }
      .grid{ grid-template-columns:1fr; }
    }

    .panel{
      padding:14px;
      border-radius:var(--radius);
      background: rgba(255,255,255,.02);
      border:1px solid var(--stroke);
      min-width:0;
    }
    .panel h3{ margin:0 0 10px; font-size:13px; font-weight:900; color:rgba(255,255,255,.90); }
    .muted{ color:var(--muted); font-size:12px; }
    .muted2{ color:var(--muted2); font-size:12px; }

    .table{ width:100%; border-collapse:separate; border-spacing:0 10px; font-size:12px; }
    .table th{ text-align:left; color:var(--muted); font-weight:900; font-size:11px; padding:0 10px; }
    .row{ background: rgba(255,255,255,.03); border:1px solid var(--stroke); border-radius:14px; }
    .table td{ padding:12px 10px; vertical-align:middle; }

    .input{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      color:var(--text);
      outline:none;
      font-weight:900;
      font-size:12px;
    }

    .logbox{
      background: rgba(0,0,0,.25);
      border:1px solid var(--stroke);
      border-radius:16px;
      padding:12px;
      min-height:120px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:11px;
      color: rgba(255,255,255,.86);
      overflow:auto;
      white-space:pre-wrap;
    }

    /* Chat */
    .chatWrap{ display:flex; flex-direction:column; gap:10px; min-height:520px; }
    .chatHistory{
      flex:1;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.22);
      border-radius:16px;
      padding:12px;
      overflow:auto;
      font-size:12px;
      color: rgba(255,255,255,.88);
      line-height:1.45;
    }
    .bubble{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      margin:8px 0;
      max-width: 92%;
      white-space:pre-wrap;
    }
    .bubble.me{
      background: rgba(139,92,246,.12);
      border-color: rgba(139,92,246,.28);
      margin-left:auto;
    }
    .bubble.ai{
      background: rgba(34,197,94,.10);
      border-color: rgba(34,197,94,.26);
    }
    .chatRow{ display:flex; gap:10px; align-items:center; }
    .smallbtn{ padding:9px 10px; border-radius:12px; font-size:12px; font-weight:900; }
  </style>
</head>

<body>
  <div class="app">
    <aside class="sidebar card">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>BossMind Admin</h1>
          <p class="muted">Automation • Switches • Jobs • Queue</p>
        </div>
      </div>

      <div class="panel" style="padding:12px">
        <div class="muted2">System Status</div>
        <div style="height:10px"></div>
        <span class="chip"><span class="dot" id="dotBackend"></span><span id="txtBackend">Backend: unknown</span></span>
      </div>

      <div class="nav">
        <button class="navbtn active" data-view="command">
          <div class="navleft">
            <div class="navtitle">Command Center</div>
            <div class="navsub">Global</div>
          </div>
          <span class="badge">Global</span>
        </button>

        <button class="navbtn" data-view="builder">
          <div class="navleft">
            <div class="navtitle">AI Builder</div>
            <div class="navsub">Project 1</div>
          </div>
          <span class="badge p1">Project 1</span>
        </button>

        <button class="navbtn" data-view="video">
          <div class="navleft">
            <div class="navtitle">AI Video Generator</div>
            <div class="navsub">Project 2</div>
          </div>
          <span class="badge p2">Project 2</span>
        </button>

        <button class="navbtn" data-view="stock">
          <div class="navleft">
            <div class="navtitle">AI Stock System</div>
            <div class="navsub">Project 3</div>
          </div>
          <span class="badge p3">Project 3</span>
        </button>

        <!-- ✅ NEW CHAT BUTTON -->
        <button class="navbtn" data-view="chat">
          <div class="navleft">
            <div class="navtitle">AI Chat</div>
            <div class="navsub">Support & future updates</div>
          </div>
          <span class="badge">Chat</span>
        </button>

        <button class="navbtn" data-view="logs">
          <div class="navleft">
            <div class="navtitle">Logs & Audit</div>
            <div class="navsub">Ops</div>
          </div>
          <span class="badge">Ops</span>
        </button>

        <button class="navbtn" data-view="settings">
          <div class="navleft">
            <div class="navtitle">System Settings</div>
            <div class="navsub">Connection & switches</div>
          </div>
          <span class="badge">Config</span>
        </button>
      </div>

      <div class="panel">
        <h3 style="margin:0 0 10px">Quick Actions</h3>
        <div class="muted2" id="clock">—</div>
        <div style="height:10px"></div>
        <div style="display:flex;flex-direction:column;gap:10px">
          <button class="btn primary" id="btnRefreshUI">↻ Refresh UI</button>
          <button class="btn good" id="btnHealth">✓ Health Check</button>
          <button class="btn warn" id="btnSync">⇄ Sync (Sheet/DB/Config)</button>
          <button class="btn" id="btnAuto">Auto: OFF</button>
        </div>
      </div>
    </aside>

    <main class="main card">
      <div class="topbar">
        <h2 id="viewTitle">Logs & Audit</h2>
        <div class="right">
          <span class="chip"><span class="dot" id="dotApi"></span><span id="txtApi">API: not set</span></span>
          <button class="btn smallbtn" onclick="location.href='/admin.html'">Open admin.html</button>
          <button class="btn smallbtn" onclick="location.href='/automation.html'">Open automation.html</button>
        </div>
      </div>

      <div class="grid">
        <section class="panel" id="panelLeft"></section>

        <section class="panel" id="panelRight">
          <div style="display:flex; align-items:center; justify-content:space-between; gap:10px">
            <div>
              <h3 style="margin:0">Operations Console</h3>
              <div class="muted2">Status • logs • quick verification</div>
            </div>
            <div style="display:flex; gap:10px; flex-wrap:wrap">
              <button class="btn" id="loadLogs2">Load Logs</button>
              <button class="btn" id="clearLogs">Clear</button>
              <button class="btn" id="copyLogs">Copy</button>
              <button class="btn" id="btnPing">Ping</button>
            </div>
          </div>

          <div style="height:12px"></div>

          <div class="panel" style="padding:14px; background:rgba(255,255,255,.02)">
            <div style="display:flex; align-items:center; justify-content:space-between">
              <h3 style="margin:0">Live Status Snapshot</h3>
              <button class="btn" id="btnMiniRefresh">Refresh</button>
            </div>
            <div style="height:10px"></div>
            <table class="table">
              <thead><tr><th>Metric</th><th>Value</th></tr></thead>
              <tbody>
                <tr class="row"><td>Active View</td><td id="ssView">—</td></tr>
                <tr class="row"><td>API Base</td><td id="ssApi">—</td></tr>
                <tr class="row"><td>Backend</td><td id="ssBackend">—</td></tr>
                <tr class="row"><td>Last Action</td><td id="ssLast">—</td></tr>
              </tbody>
            </table>
            <div style="height:10px"></div>
            <div class="muted2">Health endpoint: GET <b>/health</b></div>
          </div>

          <div style="height:12px"></div>

          <div class="panel" style="padding:14px">
            <div style="display:flex; align-items:center; justify-content:space-between">
              <h3 style="margin:0">Logs</h3>
              <div style="display:flex; gap:10px; align-items:center">
                <div class="muted2">Filter</div>
                <select class="input" style="width:140px; padding:10px" id="logFilter">
                  <option>All</option>
                </select>
              </div>
            </div>
            <div style="height:10px"></div>
            <div class="logbox" id="logbox2"></div>
          </div>
        </section>
      </div>
    </main>
  </div>

<script>
/* ===========================
   BossMind UI Runtime
=========================== */
const LS = {
  apiBase: "bossmind_api_base",
  auto: "bossmind_auto",
  logs: "bossmind_logs"
};

const state = {
  view: "logs",
  apiBase: localStorage.getItem(LS.apiBase) || "",
  auto: (localStorage.getItem(LS.auto) || "OFF"),
  logs: JSON.parse(localStorage.getItem(LS.logs) || "[]"),
  backendUp: null,
  lastAction: ""
};

function inferDefaultApiBase(){
  // If not set, default to same origin (works on video.bossmind.ai)
  return window.location.origin;
}

function getApiBase(){
  return (state.apiBase && state.apiBase.trim()) ? state.apiBase.trim() : inferDefaultApiBase();
}

function nowStamp(){
  const d = new Date();
  const pad = (n)=> String(n).padStart(2,"0");
  const y = d.getFullYear();
  const m = pad(d.getMonth()+1);
  const day = pad(d.getDate());
  let hh = d.getHours();
  const mm = pad(d.getMinutes());
  const ss = pad(d.getSeconds());
  const ampm = hh >= 12 ? "PM" : "AM";
  hh = hh % 12; if(hh===0) hh=12;
  return `${m}/${day}/${y}, ${hh}:${mm}:${ss} ${ampm}`;
}

function log(msg){
  const entry = `[${new Date().toISOString().replace("T"," ").replace("Z","")}] ${msg}`;
  state.logs.unshift(entry);
  state.logs = state.logs.slice(0, 300);
  localStorage.setItem(LS.logs, JSON.stringify(state.logs));
  state.lastAction = msg;
  renderSnapshot();
  renderLogs();
}

function setApiBase(v){
  state.apiBase = (v || "").trim();
  if(state.apiBase){
    localStorage.setItem(LS.apiBase, state.apiBase);
  }else{
    localStorage.removeItem(LS.apiBase);
  }
  renderTop();
  renderSnapshot();
}

function setAuto(){
  state.auto = (state.auto === "ON") ? "OFF" : "ON";
  localStorage.setItem(LS.auto, state.auto);
  document.getElementById("btnAuto").textContent = `Auto: ${state.auto}`;
  log(`Auto toggled ${state.auto}`);
}

function renderTop(){
  const txtApi = document.getElementById("txtApi");
  const dotApi = document.getElementById("dotApi");
  const using = getApiBase();
  const isExplicit = !!(state.apiBase && state.apiBase.trim());

  txtApi.textContent = isExplicit ? `API: set` : `API: not set`;
  dotApi.className = "dot " + (using ? "good" : "");
}

function renderBackend(){
  const txtBackend = document.getElementById("txtBackend");
  const dotBackend = document.getElementById("dotBackend");
  const v = state.backendUp;
  if(v === true){
    txtBackend.textContent = "Backend: up";
    dotBackend.className = "dot good";
  }else if(v === false){
    txtBackend.textContent = "Backend: down";
    dotBackend.className = "dot bad";
  }else{
    txtBackend.textContent = "Backend: unknown";
    dotBackend.className = "dot";
  }
}

function titleForView(v){
  return ({
    command:"Command Center",
    builder:"AI Builder",
    video:"AI Video Generator",
    stock:"AI Stock System",
    chat:"AI Chat",
    logs:"Logs & Audit",
    settings:"System Settings"
  })[v] || "Logs & Audit";
}

function renderSnapshot(){
  document.getElementById("ssView").textContent = titleForView(state.view);
  document.getElementById("ssApi").textContent = getApiBase();
  document.getElementById("ssBackend").textContent =
    (state.backendUp===true) ? "up" : (state.backendUp===false ? "down" : "unknown");
  document.getElementById("ssLast").textContent = state.lastAction || "—";
}

function renderLogs(){
  const box = document.getElementById("logbox2");
  if(!box) return;
  box.textContent = state.logs.length ? state.logs.join("\n") : "(no logs yet)";
}

function setView(v){
  state.view = v;
  document.getElementById("viewTitle").textContent = titleForView(v);
  document.querySelectorAll(".navbtn").forEach(b=>{
    b.classList.toggle("active", b.dataset.view === v);
  });
  renderPanels();
  log(`Switched to ${titleForView(v)}`);
}

async function healthCheck(){
  const base = getApiBase().replace(/\/+$/,"");
  const url = base + "/health";
  try{
    const res = await fetch(url, { method:"GET" });
    state.backendUp = res.ok;
  }catch(e){
    state.backendUp = false;
  }
  renderBackend();
  renderSnapshot();
  log(`Health check executed (${state.backendUp ? "up" : "down"})`);
}

async function ping(){
  // Use /health as a safe ping
  await healthCheck();
}

function sync(){
  log("Sync triggered (placeholder)");
  alert("Sync is placeholder. Backend wiring can be added later.");
}

function refreshUI(){
  renderPanels();
  renderTop();
  renderBackend();
  renderSnapshot();
  log("UI refreshed");
}

function exportLocal(){
  const payload = {
    apiBaseExplicit: state.apiBase || null,
    apiBaseEffective: getApiBase(),
    auto: state.auto,
    logsCount: state.logs.length,
    exportedAt: new Date().toISOString()
  };
  const txt = JSON.stringify(payload, null, 2);
  navigator.clipboard?.writeText(txt).catch(()=>{});
  alert("Export copied to clipboard.");
  log("Exported local settings (clipboard)");
}

function resetLocal(){
  localStorage.removeItem(LS.apiBase);
  localStorage.removeItem(LS.auto);
  localStorage.removeItem(LS.logs);
  state.apiBase = "";
  state.auto = "OFF";
  state.logs = [];
  state.backendUp = null;
  state.lastAction = "";
  document.getElementById("btnAuto").textContent = "Auto: OFF";
  renderTop();
  renderBackend();
  renderPanels();
  log("Local settings reset");
}

function escapeHtml(s){
  return String(s||"")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/* ================
   CHAT (REAL CALL)
================ */
function appendBubble(kind, text){
  const h = document.getElementById("chatHistory");
  if(!h) return;
  const div = document.createElement("div");
  div.className = "bubble " + (kind === "me" ? "me" : "ai");
  div.textContent = text;
  h.appendChild(div);
  h.scrollTop = h.scrollHeight;
}

async function sendChat(){
  const input = document.getElementById("chatInput");
  const btn = document.getElementById("chatSend");
  const msg = (input.value || "").trim();
  if(!msg) return;

  appendBubble("me", msg);
  input.value = "";

  const base = getApiBase().replace(/\/+$/,"");
  const url = base + "/chat";

  btn.disabled = true;
  btn.textContent = "Sending...";

  try{
    const res = await fetch(url, {
      method: "POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify({ message: msg })
    });

    if(!res.ok){
      appendBubble("ai", `Chat endpoint not ready. HTTP ${res.status}.`);
      log(`Chat send failed (HTTP ${res.status})`);
      return;
    }

    const data = await res.json().catch(()=>null);
    const reply = (data && (data.reply || data.message || data.text)) ? (data.reply || data.message || data.text) : "(No reply field returned)";
    appendBubble("ai", reply);
    log("Chat message sent");
  }catch(e){
    appendBubble("ai", "Chat endpoint not reachable yet.");
    log("Chat send failed (network)");
  }finally{
    btn.disabled = false;
    btn.textContent = "Send";
  }
}

/* ===========================
   Views
=========================== */
function renderPanels(){
  const left = document.getElementById("panelLeft");
  const v = state.view;

  if(v === "logs"){
    left.innerHTML = `
      <h3>Logs & Audit</h3>
      <div class="muted">Operational trace and local snapshot.</div>
      <div style="height:12px"></div>
      <div class="panel" style="padding:14px">
        <div class="muted2">Audit & Trace</div>
        <div style="height:10px"></div>
        <div style="display:flex; gap:10px; flex-wrap:wrap">
          <button class="btn" id="loadLogs">Load Logs</button>
          <button class="btn" id="exportLocal">Export Local Settings</button>
          <button class="btn danger" id="resetLocal">Reset Local Settings</button>
        </div>
      </div>

      <div style="height:12px"></div>

      <div class="panel" style="padding:14px">
        <div class="muted2">Local Snapshot</div>
        <div style="height:10px"></div>
        <table class="table">
          <thead><tr><th>Key</th><th>Value</th></tr></thead>
          <tbody>
            <tr class="row"><td>Connection</td><td>${(state.apiBase && state.apiBase.trim()) ? "Set" : "Not set"}</td></tr>
            <tr class="row"><td>Builder</td><td>Not set</td></tr>
            <tr class="row"><td>Video</td><td>Not set</td></tr>
            <tr class="row"><td>Stock</td><td>Not set</td></tr>
            <tr class="row"><td>Switches</td><td>Saved</td></tr>
          </tbody>
        </table>
      </div>
    `;
    document.getElementById("loadLogs").onclick = renderLogs;
    document.getElementById("exportLocal").onclick = exportLocal;
    document.getElementById("resetLocal").onclick = resetLocal;
    return;
  }

  if(v === "settings"){
    left.innerHTML = `
      <h3>System Settings</h3>
      <div class="muted">Set API base (optional). If empty, it uses the same domain automatically.</div>
      <div style="height:12px"></div>

      <div class="muted2">API Base URL</div>
      <div style="height:8px"></div>
      <input class="input" id="apiBaseInput" placeholder="Example: https://ai-video-maker-production.up.railway.app" value="${escapeHtml(state.apiBase)}" />
      <div style="height:10px"></div>

      <div style="display:flex; gap:10px; flex-wrap:wrap">
        <button class="btn primary" id="saveApi">Save</button>
        <button class="btn" id="clearApi">Clear</button>
      </div>

      <div style="height:12px"></div>
      <div class="muted2">Effective API Base:</div>
      <div style="height:8px"></div>
      <div class="logbox" style="min-height:auto">${escapeHtml(getApiBase())}</div>
    `;

    document.getElementById("saveApi").onclick = ()=>{
      const v = document.getElementById("apiBaseInput").value;
      setApiBase(v);
      log("API Base URL saved");
    };
    document.getElementById("clearApi").onclick = ()=>{
      setApiBase("");
      const inp = document.getElementById("apiBaseInput");
      if(inp) inp.value = "";
      log("API Base URL cleared (auto uses same domain)");
    };
    return;
  }

  if(v === "chat"){
    left.innerHTML = `
      <h3>AI Chat</h3>
      <div class="muted">Chat is active as a UI now. Backend endpoint: <b>POST /chat</b></div>
      <div style="height:12px"></div>

      <div class="chatWrap">
        <div class="chatHistory" id="chatHistory"></div>

        <div class="chatRow">
          <input class="input" id="chatInput" placeholder="Type message..." />
          <button class="btn primary" id="chatSend">Send</button>
        </div>

        <div class="muted2">
          API Base used: <b>${escapeHtml(getApiBase())}</b>
        </div>
      </div>
    `;

    // Seed greeting
    appendBubble("ai", "BossMind Chat UI is ready. If /chat is not implemented yet, you will see a safe message.");
    document.getElementById("chatSend").onclick = sendChat;
    document.getElementById("chatInput").addEventListener("keydown", (e)=>{
      if(e.key === "Enter") sendChat();
    });
    return;
  }

  // Other views (minimal placeholders)
  left.innerHTML = `
    <h3>${titleForView(v)}</h3>
    <div class="muted">Panel is ready. Backend wiring can be added later.</div>
  `;
}

/* ===========================
   Init / Wire buttons
=========================== */
function tickClock(){
  document.getElementById("clock").textContent = nowStamp();
}

document.getElementById("btnAuto").addEventListener("click", setAuto);
document.getElementById("btnHealth").addEventListener("click", healthCheck);
document.getElementById("btnSync").addEventListener("click", sync);
document.getElementById("btnRefreshUI").addEventListener("click", refreshUI);
document.getElementById("btnMiniRefresh").addEventListener("click", refreshUI);

document.getElementById("btnPing").addEventListener("click", ping);
document.getElementById("loadLogs2").addEventListener("click", renderLogs);
document.getElementById("clearLogs").addEventListener("click", ()=>{
  state.logs = [];
  localStorage.setItem(LS.logs, JSON.stringify(state.logs));
  renderLogs();
  log("Logs cleared");
});
document.getElementById("copyLogs").addEventListener("click", ()=>{
  const txt = state.logs.join("\n");
  navigator.clipboard?.writeText(txt).catch(()=>{});
  alert("Logs copied to clipboard.");
  log("Logs copied");
});

document.querySelectorAll(".navbtn").forEach(b=>{
  b.addEventListener("click", ()=> setView(b.dataset.view));
});

(function init(){
  document.getElementById("btnAuto").textContent = `Auto: ${state.auto}`;
  tickClock();
  setInterval(tickClock, 1000);

  renderTop();
  renderBackend();
  renderSnapshot();
  renderPanels();

  log("UI loaded (advanced).");
})();
</script>
</body>
</html>
